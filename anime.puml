@startuml ClasificadorAnime
left to right direction
skinparam roundcorner 20
skinparam shadowing false
skinparam classAttributeIconSize 0
skinparam defaultFontName "Arial"

legend top
|= Símbolo |= Relación |= Descripción |
| <|-- | Herencia | Relación "es-un" |
| *--  | Composición | Parte-de (ciclo de vida dependiente) |
| o--  | Agregación  | Tiene-un (ciclo de vida independiente) |
| -->  | Asociación  | Vinculación estructural |
| ..>  | Dependencia | Uso puntual (no estructural) |
endlegend

'----------- PAQUETES -------------'

package ui {
  class AnimeUI {
    +mostrarMenu(): void
    +mostrarAnimes(animes: List<Anime>): void
    +crearAnime(): void
    +filtrarPorGenero(): void
    +filtrarPorEstado(): void
    +filtrarPorCalificacion(): void
    +crearLista(): void
    +agregarAnimeALista(): void
    +mostrarListas(): void
  }
}

package service {
  interface IAnimeService {
    +crearAnime(titulo: String, anioLanzamiento: int, cantidadCapitulos: int, estado: EstadoAnime, calificacion: int, generos: List<Generos>): void
    +ordenarAnimes(animes: List<Anime>, criterio: CriterioOrdenamiento): List<Anime>
    +filtrar(filtro: CriterioFiltrado): List<Anime>
    +obtenerPromedioCalificacionesGlobal(): double
    +obtenerAnimesPorGenero(genero: Generos): List<Anime>
    +cantidadAnimesPorEstado(): Map<EstadoAnime, int>
    +obtenerPromedioCalificacionPorGenero(): Map<Generos, double>
    +top3GenerosMasFrecuentes(): List<Generos>
    +recomendar(criterio: CriterioRecomendacion, n: int): List<Anime>
  }

  interface IListaService {
    +crearLista(nombre: String): Lista
    +agregarAnimeALista(idLista: int, idAnime: int)
    +eliminarAnimeDeLista(idLista: int, idAnime: int)
    +obtenerListasQueContienenAnime(idAnime: int): List<Lista>
    +listarListas(): List<Lista>
  }

  interface CriterioOrdenamiento {
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
  }


  abstract class OrdenadorTemplate {
    #obtenerValor(anime: Anime): int
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
    -quicksort(lista: List<Anime>, inicio: int, fin: int, orden: Ordenamientos): void
    -particionar(lista: List<Anime>, inicio: int, fin: int, orden: Ordenamientos): int
  }

  abstract class OrdenadorTemplateString {
    #obtenerValorString(anime: Anime): String
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
    -quicksort(lista: List<Anime>, inicio: int, fin: int, orden: Ordenamientos): void
    -particionar(lista: List<Anime>, inicio: int, fin: int, orden: Ordenamientos): int
  }

  class OrdenarPorCalificaciones {
    #obtenerValor(anime: Anime): int
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
  }

  class OrdenarPorAnio {
    #obtenerValor(anime: Anime): int
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
  }

  class OrdenarPorTitulo {
    #obtenerValorString(anime: Anime): String
    +ordenar(animes: List<Anime>): void
    +ordenar(animes: List<Anime>, orden: Ordenamientos): void
  }

  interface CriterioFiltrado {
    +filtrar(animes: List<Anime>): List<Anime>
  }

  abstract class FiltradorTemplate {
    #obtenerValor(anime: Anime): int
    +filtrar(animes: List<Anime>): List<Anime>
  }

  class FiltroPorGenero {
    -generoBuscado: Generos
    +filtrar(animes: List<Anime>): List<Anime>
  }

  class FiltroPorEstado {
    -estadoBuscado: EstadoAnime
    +FiltroPorEstado(estadoBuscado: EstadoAnime)
    +filtrar(animes: List<Anime>): List<Anime>
    +cumpleCondicion(anime: Anime): boolean
  }

  class FiltroPorCalificacionMinima {
    -calificacionMinima: int
    +FiltroPorCalificacionMinima(calificacionMinima: int)
    +filtrar(animes: List<Anime>): List<Anime>
    +cumpleCondicion(anime: Anime): boolean
  }

  interface CriterioRecomendacion {
    +recomendar(animes: List<Anime>, n: int): List<Anime>
  }
  class RecomendacionPorGenero {
    +recomendar(animes: List<Anime>, n: int): List<Anime>
  }

  class RecomendacionGlobal {
    +recomendar(animes: List<Anime>, n: int): List<Anime>
  }

  class AnimeYaExisteException
  class AnimeNoEncontradoException
  class ListaYaExisteException
}

package repository {
  interface IAnimeRepository {
    +guardarAnime(anime: Anime): void
    +obtenerAnimesPorTitulo(titulo: String): List<Anime>
    ' coincidencia parcial del titulo para obtener anime
    +obtenerAnimesPorRangoAños(añoDesde: int, añoHasta: int): List<Anime>
    +obtenerAnimePorId(id: int): Anime
    +eliminarAnime(titulo: String): void
    +actualizarAnime(anime: Anime): void
    +listarAnimes(): List<Anime>
  }

  interface IListaRepository {
    +guardarLista(lista: Lista): Lista
    +obtenerListaPorNombre(nombre: String): Lista
    +obtenerListaPorId(idLista: int): Lista
    +obtenerListasPorIdAnime(idAnime: int): List<Lista>
    ' obtiene todas las listas en las que se encuentra un anime determinado.
  }


  class AnimeRepositoryArchivo {
    +guardarAnime(anime: Anime): Anime
    +obtenerAnimesPorTitulo(titulo: String): List<Anime>
    +obtenerAnimesPorRangoAños(añoDesde: int, añoHasta: int): List<Anime>
    +obtenerAnimePorId(id: int): Anime
    +eliminarAnime(titulo: String): void
    +actualizarAnime(anime: Anime): void
    +listarAnimes(): List<Anime>
    -cargarDesdeArchivo(): void
    -guardarEnArchivo(): void
  }

  class ListaRepositoryArchivo {
    +guardarLista(lista: Lista): Lista
    +obtenerListaPorNombre(nombre: String): Lista
    +obtenerListaPorId(idLista: int): Lista
    +obtenerListasPorIdAnime(idAnime: int): List<Lista>
    -cargarDesdeArchivo(): void
    -guardarEnArchivo(): void
  }

  class PersistenciaException
}

package model {
  class Anime {
    -id: int
    -titulo: String
    -anioLanzamiento: int
    -estudio: Estudios
    -cantidadCapitulos: int
    -estado: EstadoAnime
    -calificacionUsuarios: int
    -generos: List<Generos>
    +Anime(titulo: String, anioLanzamiento: int, cantidadCapitulos: int, estado: EstadoAnime, calificacion: int, generos: List<Generos>): void
    +validarTitulo(titulo: String): void
    +validarAnio(anioLanzamiento: int): void
    +validarCapitulos(cantidadCapitulos: int): void
    +validarCalificacion(calificacionUsuarios: int): void
    +validarGeneros(generos: List<Generos>): void
    +setEstado(estado: EstadoAnime): void
    +agregarGenero(genero: Generos): void
    +eliminarGenero(genero: Generos): void
    #setId(id: int): void
    ' solo debe ser llamado por el repository quien es el que asigna el id
  }

  class Lista {
    -id: int
    -nombre: String
    -animesId: List<int>
    +Lista(id: int, nombre: String): void
    +existeAnime(idAnime: int): boolean
    +agregarAnime(idAnime: int): void
  }

  enum Estudios {
    Ufotable
    MAPPA
    Kyoto Animation
    Bones
    Wit Studio
  }

  enum EstadoAnime {
    POR_VER
    VIENDO
    FINALIZADO
    ABANDONADO
  }

  enum Generos {
    SHONEN
    SHOJO
    SEINEN
    JOSEI
    MECHA
    ISEKAI
    SLICE_OF_LIFE
  }

  enum Ordenamientos {
    ASC
    DESC
  }

  class ValidacionException
}

'----------- RELACIONES -------------'
AnimeUI ..> IAnimeService
AnimeUI ..> IListaService

IAnimeService ..> IAnimeRepository
IAnimeService ..> AnimeYaExisteException
IAnimeService ..> AnimeNoEncontradoException

IListaService ..> IListaRepository
IListaService ..> IAnimeRepository
IListaService ..> ListaYaExisteException

Anime ..> ValidacionException
Lista ..> Anime

IAnimeRepository ..> PersistenciaException
IListaRepository ..> PersistenciaException

' -- Criterios de Ordenamiento -- '
IAnimeService ..> CriterioOrdenamiento
CriterioOrdenamiento <|.. OrdenadorTemplate
CriterioOrdenamiento <|.. OrdenadorTemplateString
OrdenadorTemplate <|-- OrdenarPorCalificaciones
OrdenadorTemplate <|-- OrdenarPorAnio
OrdenadorTemplateString <|-- OrdenarPorTitulo

' -- Criterios de Filtrado -- '
IAnimeService ..> CriterioFiltrado
CriterioFiltrado <|.. FiltradorTemplate
CriterioFiltrado <|.. FiltroPorGenero
FiltradorTemplate <|-- FiltroPorEstado
FiltradorTemplate <|-- FiltroPorCalificacionMinima

IAnimeService ..> CriterioRecomendacion
CriterioRecomendacion <|.. RecomendacionPorGenero
CriterioRecomendacion <|.. RecomendacionGlobal


IAnimeRepository <|.. AnimeRepositoryArchivo
IListaRepository <|.. ListaRepositoryArchivo

AnimeRepositoryArchivo ..> PersistenciaException
ListaRepositoryArchivo ..> PersistenciaException

'---------- NOTAS -----------------'

@enduml
